<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>VORTEX - Crear Carros</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --primary:#ff6a00; --primary-dark:#e05500;
      --bg:#f8f9fa; --card:#ffffff; --muted:#6c757d; --soft:#e4e7ec; --text:#222;
    }
    *{box-sizing:border-box;margin:0;padding:0;font-family:"Segoe UI", Roboto, sans-serif;}
    body{display:flex;height:100vh;background:var(--bg);color:var(--text);overflow:hidden;}
    .sidebar{width:300px;background:var(--card);border-right:1px solid var(--soft);display:flex;flex-direction:column;}
    .sidebar-header{padding:22px;border-bottom:1px solid var(--soft);display:flex;gap:12px;align-items:center;background:linear-gradient(135deg, rgba(255,106,0,0.06), rgba(255,59,59,0.04));}
    .sidebar-header img{width:48px;height:48px}
    .brand-title{font-size:20px;font-weight:900;background:linear-gradient(120deg,var(--primary),#ff3b3b);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
    .brand-sub{font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:1px}
    .menu{padding:14px;overflow:auto;flex:1}
    .menu-section-title{font-size:11px;color:var(--muted);text-transform:uppercase;margin:10px 6px 8px;font-weight:700}
    .menu-item{padding:10px 12px;border-radius:10px;display:flex;gap:10px;align-items:center;margin-bottom:6px;cursor:pointer;font-weight:600;color:var(--text);text-decoration:none;}
    .menu-item:hover{background:rgba(255,106,0,0.06)}
    .menu-item.active{background:linear-gradient(120deg,var(--primary),#ff3b3b);color:#fff;box-shadow:0 6px 18px rgba(255,106,0,0.18)}
    .main{flex:1;display:flex;flex-direction:column;overflow:hidden}
    .header{height:72px;background:var(--card);border-bottom:1px solid var(--soft);display:flex;align-items:center;justify-content:space-between;padding:0 26px;box-shadow:0 2px 8px rgba(0,0,0,0.03)}
    .status{display:flex;gap:12px;align-items:center}
    .badge{padding:7px 14px;border-radius:20px;font-weight:800;text-transform:uppercase;font-size:11px;border:1px solid rgba(255,106,0,0.18);background:linear-gradient(120deg,rgba(255,106,0,0.12),rgba(255,59,59,0.08));color:var(--primary-dark)}
    .dept{padding:6px 12px;border-radius:16px;border:1px solid var(--soft);font-weight:700}
    .user{display:flex;gap:12px;align-items:center}
    .user-info{text-align:right}
    .user-info .name{font-weight:800}
    .user-info .role{font-size:12px;color:var(--muted);text-transform:uppercase}
    .avatar{width:44px;height:44px;border-radius:50%;display:flex;align-items:center;justify-content:center;color:#fff;background:linear-gradient(135deg,var(--primary),#ff3b3b);font-weight:900}
    .body{flex:1;padding:26px;overflow:auto;background:var(--bg)}
    .card{background:var(--card);border-radius:14px;padding:20px;border:1px solid var(--soft);box-shadow:0 6px 18px rgba(0,0,0,0.03)}
    .title{font-size:22px;font-weight:900;background:linear-gradient(120deg,var(--primary),#ff3b3b);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:8px}
    .desc{color:var(--muted);margin-bottom:14px}
    form .form-group{margin-bottom:12px}
    label{display:block;font-size:12px;font-weight:700;color:var(--primary-dark);margin-bottom:6px;text-transform:uppercase}
    input,select,textarea{width:100%;padding:10px;border-radius:8px;border:1px solid var(--soft);font-size:14px;background:#fff;color:var(--text)}
    .btn{padding:11px 14px;border-radius:999px;border:none;background:linear-gradient(120deg,var(--primary),#ff3b3b);color:#fff;font-weight:800;cursor:pointer}
    .btn.secondary{background:#fff;border:1px solid var(--soft);color:var(--text)}
  </style>
</head>
<body>
  <div class="sidebar">
    <div class="sidebar-header">
      <img src="icon-vortex.png" alt="Vortex" />
      <div>
        <div class="brand-title">VORTEX</div>
        <div class="brand-sub">Panel de Control</div>
      </div>
    </div>
    <div class="menu">
      <div class="menu-section-title">Administraci√≥n</div>
      <a href="admin_panel.html" class="menu-item" id="link-cuentas">üë§ CUENTAS</a>
      <a href="crear_carros.html" class="menu-item active" id="link-carros">üöí CREAR CARROS</a>
      <a href="crear_cuarteles.html" class="menu-item" id="link-cuarteles">üè¢ CREAR CUARTELES</a>
      <a href="crear_claves.html" class="menu-item" id="link-claves">üîë CREAR CLAVES</a>
      <a href="crear_especialidades.html" class="menu-item" id="link-especialidades">‚öôÔ∏è CREAR ESPECIALIDADES</a>
      <div style="height:12px;"></div>
      <div class="menu-section-title">Operaciones</div>
      <a href="crear_emergencias.html" class="menu-item" id="link-emergencias">üö® CREAR EMERGENCIA</a>
      <a href="emergencias_activas.html" class="menu-item" id="link-emergencias-activas">üì° EMERGENCIAS ACTIVAS</a>
      <div class="menu-section-title">Reportes</div>
      <a href="informes.html" class="menu-item" id="link-informes">üìä INFORMES</a>
      <a href="material_mayor.html" class="menu-item" id="link-material">üß∞ MATERIAL MAYOR</a>
      <a href="bitacoras.html" class="menu-item" id="link-bitacoras">üìì BIT√ÅCORAS</a>
    </div>
  </div>

  <div class="main">
    <div class="header">
      <div class="status">
        <div class="badge">‚óè SISTEMA ACTIVO</div>
        <div class="dept" id="dept-name">Cargando...</div>
      </div>
      <div class="user">
        <div class="user-info">
          <span class="name" id="user-name">Cargando...</span>
          <span class="role" id="user-role">‚Äî</span>
        </div>
        <div class="avatar" id="user-avatar">V</div>
      </div>
    </div>
    <div class="body" id="main-body">
      <div class="card">
        <h2 class="title">CREAR CARROS</h2>
        <p class="desc">Aqu√≠ podr√°s agregar y administrar los carros operativos.</p>

        <form id="car-form">
          <div class="form-group">
            <label for="car-code">C√≥digo</label>
            <input type="text" id="car-code" required placeholder="Ej: C-01" />
          </div>
          <div class="form-group">
            <label for="car-name">Nombre</label>
            <input type="text" id="car-name" required placeholder="Ej: Bomba San Bernardo" />
          </div>
          <div class="form-group">
            <label for="car-specialty">Especialidad</label>
            <select id="car-specialty"></select>
          </div>
          <div class="form-group">
            <label for="car-station">Cuartel</label>
            <select id="car-station"></select>
          </div>
          <div class="form-group">
            <label for="car-status">Estado</label>
            <select id="car-status">
              <option value="activo">Activo</option>
              <option value="inactivo">Inactivo</option>
            </select>
          </div>
          <button type="submit" class="btn">Guardar Carro</button>
        </form>

        <div id="cars-list" style="margin-top:20px;"></div>
      </div>
    </div>
  </div>

  <script>
    // Sesi√≥n y mostrar usuario/depto
    const loggedUser = JSON.parse(localStorage.getItem('loggedUser'));
    const currentDept = localStorage.getItem('currentDepartment');
    if (!loggedUser) {
      window.location.href = 'index.html';
    } else {
      document.getElementById('user-name').textContent = loggedUser.nombre || loggedUser.user;
      document.getElementById('user-role').textContent = (loggedUser.role || '').toUpperCase();
      document.getElementById('user-avatar').textContent = (loggedUser.nombre || loggedUser.user).charAt(0).toUpperCase();
      document.getElementById('dept-name').textContent = currentDept || '';
    }

    // Inicializar selects
    const specialties = JSON.parse(localStorage.getItem('specialties') || '[]');
    const stations = JSON.parse(localStorage.getItem('stations') || '[]');

    const specialtySelect = document.getElementById('car-specialty');
    const stationSelect = document.getElementById('car-station');

    specialties.forEach(s => {
      const opt = document.createElement('option');
      opt.value = s;
      opt.textContent = s;
      specialtySelect.appendChild(opt);
    });

    stations.forEach(s => {
      const opt = document.createElement('option');
      opt.value = s;
      opt.textContent = s;
      stationSelect.appendChild(opt);
    });

    // Manejar formulario
    const form = document.getElementById('car-form');
    form.addEventListener('submit', e => {
      e.preventDefault();
      const code = document.getElementById('car-code').value.trim();
      const name = document.getElementById('car-name').value.trim();
      const specialty = specialtySelect.value;
      const station = stationSelect.value;
      const status = document.getElementById('car-status').value;

      if (!code || !name) {
        alert('C√≥digo y nombre son obligatorios');
        return;
      }

      let cars = JSON.parse(localStorage.getItem('cars') || '[]');

      if (cars.some(c => c.code === code)) {
        alert('Ya existe un carro con ese c√≥digo');
        return;
      }

      cars.push({ code, name, specialty, station, status, department: currentDept, createdAt: new Date().toISOString() });
      localStorage.setItem('cars', JSON.stringify(cars));
      alert('Carro creado correctamente');
      form.reset();
      renderCars();
    });

    // Renderizar lista de carros
    function renderCars() {
      const container = document.getElementById('cars-list');
      let cars = JSON.parse(localStorage.getItem('cars') || '[]');
      if (cars.length === 0) {
        container.innerHTML = '<p>No hay carros creados a√∫n.</p>';
        return;
      }
      let html = '<table style="width:100%;border-collapse:collapse;"><thead><tr><th>C√≥digo</th><th>Nombre</th><th>Especialidad</th><th>Cuartel</th><th>Estado</th></tr></thead><tbody>';
      cars.forEach(c => {
        html += `<tr>
          <td>${c.code}</td>
          <td>${c.name}</td>
          <td>${c.specialty}</td>
          <td>${c.station}</td>
          <td>${c.status}</td>
        </tr>`;
      });
      html += '</tbody></table>';
      container.innerHTML = html;
    }

    renderCars();

    // Marcar men√∫ activo
    const currentPage = window.location.pathname.split('/').pop();
    document.querySelectorAll('.menu-item').forEach(item => {
      if (item.getAttribute('href') === currentPage) {
        item.classList.add('active');
      } else {
        item.classList.remove('active');
      }
    });
  </script>
</body>
</html>
